<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>Shaka Widevine + ClientToken Example</title>

    <!-- טעינת Shaka Player מ-CDN -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/controls.css">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            background: #000;
            height: 100%;
            direction: rtl;
        }

        #video-container {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        video {
            width: 80%;
            max-width: 1280px;
            background: #000;
        }
    </style>
</head>
<body>

<div id="video-container">
    <video id="video" controls autoplay></video>
</div>

<script>
    // כתובת ה-MPD שלך (DASH)
    const manifestUri = 'https://pta1-cdn-edge-vod01.cdnhot.co.il/vodnolimit-pta1.cdnhot.co.il/sid=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJoZmExLWNkbi1zcjAwIiwiaWF0IjoxNzcwODI1NDg3LCJqdGkiOiIwNmZ0a3VyNThlMTZ1MGV1M2xqMCIsImlwIjoiMTkyLjE2OC43My4xOTgiLCJleHAiOjE3NzA4NTQyODcsInN1YiI6IlBJNTgxMDAyIn0.9ZtTvmT6g1Zlw2TKenfrTNrOidBdsoMfOFIr2NED0wo/sdash/PI581002/10.mpd/Manifest?device=VODDASHNEX';

    // ה-ClientToken שלך
    const clientToken = 'nI4Pen0njiXQN-ENByW5l2B-P1dpjfjlNDI5OTM1MDY2NSxzdWJzY3JpYmVyLTYxNiwxLEdMT0JBTCw2MTYsMTAwLDY1OCwsMjAxNTA4OTcsLCxvYW0tZGVmYXVsdC1oaWRkZW4=';

    // כתובת שרת ה-DRM (Widevine) – כמו שיש לך בקוד של HisPlayer
    const licenseServerUrl = 'https://wvlic.hot.net.il/GOC7PL6Y/wvls/contentlicenseservice/v1/licenses';

    async function initApp() {
        // בדיקת תמיכה ב-Shaka
        if (!shaka.Player.isBrowserSupported()) {
            console.error('הדפדפן לא תומך ב-Shaka / EME / MSE');
            return;
        }

        const video = document.getElementById('video');
        const player = new shaka.Player(video);

        // לוג שגיאות
        player.addEventListener('error', event => {
            console.error('שגיאת נגן:', event.detail);
        });

        // הגדרת DRM + שליחת ClientToken בכותרת
        player.configure({
            drm: {
                servers: {
                    'com.widevine.alpha': licenseServerUrl
                },
                advanced: {
                    'com.widevine.alpha': {
                        serverCertificate: null
                    }
                }
            },
            networking: {
                requestFilter: (type, request) => {
                    // מוסיפים את ה-ClientToken לכותרת הבקשה לשרת הרישוי
                    if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
                        request.headers['nv-application-data'] = clientToken;
                    }
                }
            }
        });

        try {
            await player.load(manifestUri);
            console.log('הווידאו נטען בהצלחה');
        } catch (e) {
            console.error('שגיאה בטעינת הווידאו:', e);
        }
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>Shaka Widevine + ClientToken Example</title>

    <!-- טעינת Shaka Player מ-CDN -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/controls.css">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            background: #000;
            height: 100%;
            direction: rtl;
        }

        #video-container {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        video {
            width: 80%;
            max-width: 1280px;
            background: #000;
        }
    </style>
</head>
<body>

<div id="video-container">
    <video id="video" controls autoplay></video>
</div>

<script>
    // כתובת ה-MPD שלך (DASH)
    const manifestUri = 'https://pta1-cdn-edge-live02.cdnhot.co.il/livenolimit-pta1.cdnhot.co.il/sid=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJoZmExLWNkbi1zcjAwIiwiaWF0IjoxNzcwODIyMDA2LCJqdGkiOiIwNmZzcWNzNmdzY25mcnJrYmVlMCIsImlwIjoiMTkyLjE2OC43My4yMDIiLCJleHAiOjE3NzA4NTA4MDYsInN1YiI6IkxJVkUkU3BvcnRfMV9IRF8yMDE1NCJ9.oHco_jgYu7xTyd-AaL0fm7_wWRP25FyabsNM_lkF05o/sdash/LIVE$Sport_1_HD_20154/5.mpd/Manifest?start=LIVE&end=END&device=NAGRA-WV-MAIN-LIVE-CDN';

    // ה-ClientToken שלך
    const clientToken = 'M3UYlYkIci45r4UzI3QsmOvtYstpjeoSNDI5OTM1MDY2NSxzdWJzY3JpYmVyLTYxNiwxLEdMT0JBTCw2MTYsMTAwLDY1OCwsMjAxNTA4OTcsLCxvYW0tZGVmYXVsdC1oaWRkZW4=';

    // כתובת שרת ה-DRM (Widevine) – כמו שיש לך בקוד של HisPlayer
    const licenseServerUrl = 'https://wvlic.hot.net.il/GOC7PL6Y/wvls/contentlicenseservice/v1/licenses';

    async function initApp() {
        // בדיקת תמיכה ב-Shaka
        if (!shaka.Player.isBrowserSupported()) {
            console.error('הדפדפן לא תומך ב-Shaka / EME / MSE');
            return;
        }

        const video = document.getElementById('video');
        const player = new shaka.Player(video);

        // לוג שגיאות
        player.addEventListener('error', event => {
            console.error('שגיאת נגן:', event.detail);
        });

        // הגדרת DRM + שליחת ClientToken בכותרת
        player.configure({
            drm: {
                servers: {
                    'com.widevine.alpha': licenseServerUrl
                },
                advanced: {
                    'com.widevine.alpha': {
                        serverCertificate: null
                    }
                }
            },
            networking: {
                requestFilter: (type, request) => {
                    // מוסיפים את ה-ClientToken לכותרת הבקשה לשרת הרישוי
                    if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
                        request.headers['nv-application-data'] = clientToken;
                    }
                }
            }
        });

        try {
            await player.load(manifestUri);
            console.log('הווידאו נטען בהצלחה');
        } catch (e) {
            console.error('שגיאה בטעינת הווידאו:', e);
        }
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>